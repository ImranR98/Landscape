---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mdscl
  namespace: production
  labels:
    app: mdscl
spec:
  replicas: 1
  selector:
    matchLabels:
      app: mdscl
  template:
    metadata:
      labels:
        app: mdscl
    spec:
      securityContext:
        runAsUser: 1000
        runAsGroup: 1000
        fsGroup: 1000
      containers:
        - name: mdscl-camera
          image: imranrdev/media-date-standardize-copy-loop:latest
          imagePullPolicy: Always
          volumeMounts:
            - name: phonesync
              mountPath: /source
              subPath: DCIM/Camera
            - name: media
              mountPath: /destination
              subPath: Camera
          env:
            - name: NTFY_URL
              value: "https://ntfy.staging.imranr.dev/pcx_services_mdscl_errors"
            - name: NTFY_TOKEN
              value: tk_e4sjkxevnngm30q2t9n41yv6dp1qi
        - name: mdscl-screenshots
          image: imranrdev/media-date-standardize-copy-loop:latest
          imagePullPolicy: Always
          volumeMounts:
            - name: phonesync
              mountPath: /source
              subPath: Screenshots
            - name: media
              mountPath: /destination
              subPath: Screenshots
          env:
            - name: NTFY_URL
              value: "https://ntfy.staging.imranr.dev/pcx_services_mdscl_errors"
            - name: NTFY_TOKEN
              value: tk_e4sjkxevnngm30q2t9n41yv6dp1qi
        - name: mdscl-screenrecs
          image: imranrdev/media-date-standardize-copy-loop:latest
          imagePullPolicy: Always
          volumeMounts:
            - name: phonesync
              mountPath: /source
              subPath: "Screen Recordings"
            - name: media
              mountPath: /destination
              subPath: Screenshots
          env:
            - name: NTFY_URL
              value: "https://ntfy.staging.imranr.dev/pcx_services_mdscl_errors"
            - name: NTFY_TOKEN
              value: tk_e4sjkxevnngm30q2t9n41yv6dp1qi
      volumes:
        - name: media
          persistentVolumeClaim:
            claimName: main-media-pvc
        - name: phonesync
          persistentVolumeClaim:
            claimName: phone-sync-folders-pvc